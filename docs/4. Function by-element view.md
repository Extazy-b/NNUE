# Gradient calculation

## Conitions
### Dimensions
```math
L, N, M \in \N
```
### Constants
```math
X_1, X_2 \in \R^{N \times L} \\
Y_{exp} \in \R^{1 \times L} \\
t \in \R
1_L = \left(1, \dots, 1 \right) \in \R^{1 \times L}
```
### Vatiables
```math
A_1, A_2 \in \R^{M \times N} \\
B_1, B_2 \in \R^{M \times 1} \\
C \in \R^{1 \times 2M} \\
d \in \R
```
### Вesignations
```math
E^i - i_{th} \, element \, of \, column-vector \:E \\
E_j - j_{th} \, element \, of \, row-vector \: E \\
E^i_j - element \, in \, the \, i_{th} \, row \, and \, j_{th} \, column\,  of \, matrix \: E
```
### General expression
```math
Loss(A_1, A_2, B_1, B_2, C, d) = \frac{1}{L} \cdot ||Y_{exp} - (C \cdot CReLU(\left[ A_1 \times X_1 + B_1 \cdot 1_L \right] || \left[ A_2 \times X_2 + B_2 \cdot 1_L \right] , t) + d)||^2_2
```
### By elements
```math
\\
Loss = \frac{1}{L}\sum_{l=1}^L 
\left( 
    Y_{exp,l}- 
    \sum_{r=1}^{2M} 
        C_r
        \cdot
        \begin{cases}
                0, 
                & \sum_{k=1}^N \left[ A^r_{1, k} \cdot X^k_{1, l} \right] + B_{1}^r < 0,
                & 0 < r \le M \\

                \sum_{k=1}^N 
                \left[  
                    A^r_{1, k} \cdot X^k_{1, l} 
                \right] 
                + B_{1}^r, 
                & 0 \le \sum_{k=1}^N \left[ A^r_{1, k} \cdot X^k_{1, l} \right] + B_{1}^r \le t,
                & 0 < r \le M \\
                
                t, 
                & \sum_{k=1}^N \left[      A^r_{1, k} \cdot X^k_{1, l} \right] + B_{1}^r > t,
                & 0 < r \le M \\
                
                0, 
                & \sum_{k=1}^N \left[ A^{r−M}_{2, k} \cdot X^k_{2, l}\right] + B_{2}^{r−M} < 0,
                & M < r \le 2M \\

                \sum_{k=1}^N \left[ A^{r−M}_{2, k} \cdot X^k_{2, l} \right] + B_{2}^{r−M}, 
                & 0 \le \sum_{k=1}^N \left[ A^{r−M}_{2, k} \cdot X^k_{2, l} \right] + B_{2}^{r−M} \le t,
                & M < r \le 2M \\

                t, 
                &\sum_{k=1}^N \left[ A^{r−M}_{2, k} \cdot X^k_{2, l} \right] + B_{2}^{r−M} > t,
                & M < r \le 2M
        \end{cases}
\right)^2
```